# 🚀 Tracker App API

Приложение для отслеживания навыков и прогресса обучения с REST API, системой достижений и автоматическим управлением уровнями.

## 📋 Содержание

- [Установка и запуск](#установка-и-запуск)
- [API Эндпоинты](#api-эндпоинты)
- [Система достижений](#система-достижений)
- [Система уровней](#система-уровней)
- [Автоматизация и утилиты](#автоматизация-и-утилиты)
- [Тестирование](#тестирование)
- [Структура проекта](#структура-проекта)
- [Архитектура](#архитектура)

## 🔧 Установка и запуск

### Предварительные требования

- Node.js (версия 16 или выше)
- PostgreSQL
- npm или yarn

### 1. Установка зависимостей

```bash
npm install
```

### 2. Настройка базы данных

Убедитесь, что PostgreSQL запущен и создайте базу данных:

```sql
CREATE DATABASE tracker;
```

Обновите настройки подключения в `config/db.js` если необходимо.

### 3. Инициализация базы данных и достижений

```bash
# Синхронизация структуры БД
npm run sync-db

# Инициализация системы достижений (33 достижения)
npm run init-achievements

# Миграция данных (при необходимости)
npm run migrate-db
```

### 4. Запуск сервера

```bash
# Разработка (с автоперезагрузкой)
npm run dev

# Продакшн
npm start

# Запуск с автоматическим поиском свободного порта
# Сервер автоматически найдет свободный порт, начиная с 3000
```

Сервер запустится на `http://localhost:3000` (или на первом доступном порту)

### 5. Дополнительные команды

```bash
# Пересчет уровней для всех пользователей
npm run recalculate-levels

# Запуск тестов
npm test

# Тестирование только системы достижений
npm run test:achievements

# Тестирование системы уровней
npm run test:levels-standalone
```

## 🌐 API Эндпоинты

### Основные

- `GET /` - Информация об API
- `GET /health` - Проверка состояния сервера
- `GET /api-docs` - Swagger документация

### Пользователи (`/api/users`)

#### Аутентификация

- `POST /api/users/register` - Регистрация нового пользователя
- `POST /api/users/login` - Авторизация пользователя

#### Профиль (требует авторизации)

- `GET /api/users/profile` - Получить профиль текущего пользователя
- `PUT /api/users/profile` - Обновить данные профиля
- `PUT /api/users/change-password` - Сменить пароль
- `GET /api/users/full-info` - Полная информация с навыками и темами
- `DELETE /api/users/delete-account` - Удалить аккаунт пользователя

### Категории навыков (`/api/categories`)

- `GET /api/categories` - Получить все категории
- `POST /api/categories` - Создать новую категорию
- `GET /api/categories/stats` - Статистика по категориям
- `GET /api/categories/:id` - Получить категорию по ID
- `PUT /api/categories/:id` - Обновить категорию
- `DELETE /api/categories/:id` - Удалить категорию
- `GET /api/categories/:id/skills` - Получить навыки категории

### Навыки (`/api/skills`)

- `GET /api/skills` - Получить все навыки пользователя
- `POST /api/skills` - Создать новый навык
- `GET /api/skills/stats` - Статистика по навыкам
- `GET /api/skills/:id` - Получить навык по ID
- `PUT /api/skills/:id` - Обновить навык
- `DELETE /api/skills/:id` - Удалить навык
- `GET /api/skills/:id/topics` - Получить темы навыка

### Темы (`/api/topics`)

- `GET /api/topics` - Получить все темы с фильтрацией
- `POST /api/topics` - Создать новую тему
- `GET /api/topics/stats` - Статистика по темам
- `GET /api/topics/:id` - Получить тему по ID
- `PUT /api/topics/:id` - Обновить тему
- `DELETE /api/topics/:id` - Удалить тему
- `GET /api/topics/:id/notes` - Получить заметки темы
- `PUT /api/topics/:id/status` - Изменить статус темы

### Заметки (`/api/notes`)

- `GET /api/notes` - Получить все заметки пользователя (фильтрация: topic_id, skill_id, поиск, пагинация)
- `POST /api/notes` - Создать новую заметку
- `GET /api/notes/stats` - Статистика по заметкам
- `GET /api/notes/search` - Поиск заметок по содержимому
- `GET /api/notes/recent` - Получить последние заметки пользователя
- `GET /api/notes/:id` - Получить заметку по ID
- `PUT /api/notes/:id` - Обновить заметку
- `DELETE /api/notes/:id` - Удалить заметку

### Статусы тем (`/api/statuses`)

- `GET /api/statuses` - Получить все статусы
- `POST /api/statuses` - Создать новый статус
- `GET /api/statuses/default` - Получить статусы по умолчанию
- `POST /api/statuses/default` - Создать статусы по умолчанию
- `GET /api/statuses/stats` - Статистика по статусам
- `GET /api/statuses/:id` - Получить статус по ID
- `PUT /api/statuses/:id` - Обновить статус
- `DELETE /api/statuses/:id` - Удалить статус

### Обратная связь (`/api/feedback`)

- `GET /api/feedback` - Получить всю обратную связь (админ)
- `POST /api/feedback` - Отправить обратную связь
- `GET /api/feedback/stats` - Статистика по обратной связи
- `GET /api/feedback/:id` - Получить сообщение по ID
- `PUT /api/feedback/:id` - Обновить статус сообщения
- `DELETE /api/feedback/:id` - Удалить сообщение

### Достижения (`/api/achievements`)

- `GET /api/achievements` - Получить все доступные достижения
- `GET /api/achievements/my` - Получить достижения пользователя
- `GET /api/achievements/stats` - Статистика достижений пользователя
- `GET /api/achievements/progress` - Прогресс по всем достижениям
- `GET /api/achievements/recent` - Недавние достижения пользователя
- `GET /api/achievements/leaderboard` - Таблица лидеров по очкам
- `POST /api/achievements/recheck` - Пересчёт достижений пользователя

### Загрузка файлов (`/api/upload`)

- `POST /api/upload/avatar` - Загрузка аватара пользователя
- `DELETE /api/upload/avatar` - Удаление аватара пользователя

## 🏆 Система достижений

### Описание системы

Полноценная система геймификации с 33 различными достижениями, которые автоматически выдаются пользователям за активность в приложении.

### Типы достижений

#### 🎯 **За завершённые топики** (`topics_completed`)

- "Первые шаги" - 1 топик (10 очков)
- "Набираем обороты" - 5 топиков (25 очков)
- "Двузначный рубеж" - 10 топиков (50 очков)
- "Четверть сотни" - 25 топиков (100 очков)
- "Полувековой юбилей" - 50 топиков (200 очков)
- "Сотня!" - 100 топиков (500 очков)
- "Марафонец знаний" - 200 топиков (1000 очков)

#### 📚 **За созданные навыки** (`skills_created`)

- "Мой первый навык" - 1 навык (5 очков)
- "Коллекционер навыков" - 5 навыков (30 очков)
- "Мастер многих дел" - 10 навыков (75 очков)

#### 📝 **За написанные заметки** (`notes_written`)

- "Первая заметка" - 1 заметка (5 очков)
- "Активный писатель" - 10 заметок (40 очков)
- "Хроникёр знаний" - 25 заметок (80 очков)
- "Мастер заметок" - 50 заметок (200 очков)

#### 🏅 **За достижение уровней** (`level_reached`)

- "Уровень: Базовый" - 2 уровень (50 очков)
- "Уровень: Продвинутый" - 3 уровень (100 очков)
- "Уровень: Эксперт" - 4 уровень (250 очков)

#### 🌟 **За освоение категорий** (`categories_mastered`)

- "Первая категория" - 1 категория (30 очков)
- "Универсал" - 3 категории (100 очков)
- "Исследователь" - 5 категорий (200 очков)

#### 🎉 **За первые действия** (`first_action`)

- "Добро пожаловать!" - первый навык (5 очков)
- "Начинаем изучение" - первый топик (5 очков)
- "Первые записи" - первая заметка (5 очков)
- "Первый успех" - первый завершённый топик (15 очков)

#### 💎 **Специальные достижения** (`special`)

- "Перфекционист" - 5 топиков подряд со 100% (150 очков)
- "Спринтер" - 3 топика за день (100 очков)
- "Продуктивный день" - 5 топиков за день (150 очков)
- "Неделя целей" - топик каждый день недели (300 очков)
- "Утренняя активность" - топик до 9:00 (50 очков)
- "Ночная сова" - топик после 23:00 (50 очков)
- "Быстрый старт" - топик в час после регистрации (100 очков)
- "Возвращение" - возврат после 30 дней (75 очков)
- "Коллекционер достижений" - 10 достижений (250 очков)

### Автоматическая система

- ✅ **Автопроверка при действиях**: достижения проверяются автоматически при создании топиков, навыков, заметок
- ✅ **Интеграция с уровнями**: достижения за достижение новых уровней
- ✅ **Система очков**: каждое достижение даёт очки для рейтинга
- ✅ **Таблица лидеров**: ранжирование пользователей по очкам
- ✅ **API для статистики**: полная информация о прогрессе пользователя

### Команды управления

```bash
# Инициализация системы достижений
npm run init-achievements

# Тестирование системы достижений
npm run test:achievements

# Быстрое тестирование достижений
npm run test:achievements-quick
```

## 🎖️ Система уровней пользователя

### Автоматическое определение уровня

Система автоматически определяет уровень пользователя на основе завершенных топиков:

| Уровень             | Топики | Описание                |
| ------------------- | ------ | ----------------------- |
| 🥉 **Новичок**      | 0-4    | Начинающий пользователь |
| 🥈 **Базовый**      | 5-19   | Освоил основы           |
| � **Продвинутый**   | 20-49  | Активный ученик         |
| 🏆 **Профессионал** | 50-99  | Опытный пользователь    |
| 👑 **Эксперт**      | 100+   | Мастер своего дела      |

### Автоматическое обновление

Уровень обновляется автоматически при:

- ✅ Завершении топика (progress = 100%)
- ✅ Изменении прогресса с 100% на меньшее значение
- ✅ Удалении завершенного топика

### Дополнительные API endpoints

- `GET /api/users/progress-stats` - детальная статистика прогресса пользователя
- `POST /api/users/recalculate-level` - принудительный пересчет уровня

### Команды управления

```bash
# Пересчет уровней для всех пользователей
npm run recalculate-levels

# Тестирование системы уровней
npm run test:levels-standalone
npm run test:levels-unit
npm run test:levels-quick
```

## 🔧 Автоматизация и утилиты

### Автоматическое управление портами

Система **PortFinder** автоматически находит свободные порты:

- 🔍 **Автопоиск свободного порта** начиная с 3000
- ⚡ **Устранение конфликтов** при запуске нескольких экземпляров
- 📋 **Логирование процесса** поиска портов
- 🛡️ **Fallback** на порт по умолчанию

### Умное обнаружение сервера в тестах

Тестовая система автоматически находит запущенный сервер:

- 🔍 **Автосканирование портов** 3000-3010
- ⚙️ **Автоконфигурация** baseURL для тестов
- 🚀 **Запуск без настройки** - тесты сами найдут сервер
- 📊 **Автономность** - не требует ручного указания порта

### Утилиты разработки

```bash
# Очистка базы данных для тестов
node utils/databaseCleaner.js

# Поиск свободного порта
node utils/portFinder.js

# Управление достижениями
node utils/achievementManager.js

# Расчёт уровней пользователей
node utils/levelCalculator.js
```

### Пошаговое руководство по тестированию

#### 1. Откройте Swagger UI

Перейдите по адресу: `http://localhost:3000/api-docs`

#### 2. Авторизация в Swagger

1. Зарегистрируйте нового пользователя через `/api/users/register`
2. Авторизуйтесь через `/api/users/login` и скопируйте полученный токен
3. Нажмите кнопку **"Authorize"** в верхней части Swagger UI
4. Введите токен в формате: `Bearer YOUR_JWT_TOKEN`
5. Нажмите **"Authorize"** и затем **"Close"**

#### 3. Тестирование по порядку

**Шаг 1: Создание базовых данных**

```
1. POST /api/statuses/default - Создать статусы по умолчанию
2. POST /api/categories - Создать категорию навыка
3. POST /api/skills - Создать навык
```

**Шаг 2: Работа с темами и заметками**

```
4. POST /api/topics - Создать тему
5. PUT /api/topics/{id}/status - Изменить статус темы
6. POST /api/notes - Создать заметку для темы
```

**Шаг 3: Получение данных**

```
7. GET /api/users/full-info - Полная информация пользователя
8. GET /api/skills/stats - Статистика по навыкам
9. GET /api/topics/stats - Статистика по темам
10. GET /api/notes/search - Поиск заметок
```

#### 4. Примеры тестовых данных

**Создание категории:**

```json
{
  "name": "Программирование",
  "description": "Навыки разработки программного обеспечения"
}
```

**Создание навыка:**

```json
{
  "title": "Node.js разработка",
  "description": "Изучение серверной разработки на Node.js",
  "category_id": 1
}
```

**Создание темы:**

```json
{
  "title": "Express.js основы",
  "description": "Изучение фреймворка Express для создания API",
  "skill_id": 1,
  "status_id": 2
}
```

**Создание заметки:**

```json
{
  "content": "Express - это минималистичный веб-фреймворк для Node.js. Основные возможности: роутинг, middleware, шаблонизация.",
  "topic_id": 1
}
```

#### 5. Проверка связей между данными

Убедитесь, что:

- Навыки привязаны к пользователю и категории
- Темы привязаны к навыкам и имеют статусы
- Заметки привязаны к темам
- При удалении родительских записей корректно обрабатываются связи

#### 6. Тестирование ошибок

Протестируйте обработку ошибок:

- Попытка доступа без токена авторизации
- Создание записи с несуществующим foreign key
- Валидация обязательных полей
- Обновление несуществующих записей

## 📁 Структура проекта

```
tracker-app-server/
├── 📄 index.js                          # Точка входа приложения
├── 📄 package.json                      # Зависимости и скрипты
├── 📄 package-lock.json                 # Блокировка версий
├── 📄 README.md                         # Документация проекта
├── 📄 .gitIgnore                        # Игнорируемые Git файлы
│
├── 🔧 Скрипты инициализации
│   ├── 📄 syncDatabase.js               # Синхронизация БД
│   ├── 📄 migrateDatabase.js            # Миграции БД
│   ├── 📄 initializeAchievements.js     # Инициализация достижений
│   └── 📄 recalculateLevels.js          # Пересчёт уровней пользователей
│
├── ⚙️ config/                           # Конфигурация приложения
│   ├── 📄 db.js                         # Настройки PostgreSQL/Sequelize
│   └── 📄 swagger.js                    # Конфигурация Swagger UI
│
├── 🎮 controllers/                      # Бизнес-логика (MVC)
│   ├── 📄 userController.js             # Пользователи (регистрация, авторизация, профиль)
│   ├── 📄 userValidation.js             # Валидация пользовательских данных
│   ├── 📄 skillController.js            # Навыки (CRUD, статистика)
│   ├── 📄 skillCategoryController.js    # Категории навыков
│   ├── 📄 topicController.js            # Топики (с интеграцией достижений)
│   ├── 📄 noteController.js             # Заметки (поиск, привязка к топикам)
│   ├── 📄 topicStatusController.js      # Статусы топиков
│   ├── 📄 feedbackController.js         # Обратная связь
│   └── 📄 achievementController.js      # Система достижений
│
├── 🛡️ middlewares/                     # Промежуточное ПО
│   ├── 📄 authMiddleware.js             # JWT аутентификация
│   ├── 📄 errorHandler.js               # Централизованная обработка ошибок
│   └── 📄 imageUpload.js                # Загрузка и обработка изображений
│
├── 🗄️ models/                          # Модели данных (Sequelize)
│   ├── 📄 index.js                      # Связи между моделями
│   ├── 📄 userModel.js                  # Пользователи
│   ├── 📄 skillModel.js                 # Навыки
│   ├── 📄 skillCategoryModel.js         # Категории навыков
│   ├── 📄 topicModel.js                 # Топики/задачи
│   ├── 📄 noteModel.js                  # Заметки
│   ├── 📄 topicStatusModel.js           # Статусы топиков
│   ├── 📄 feedbackModel.js              # Обратная связь
│   ├── 📄 achievementModel.js           # Достижения
│   └── 📄 userAchievementModel.js       # Связь пользователей и достижений
│
├── 🛣️ routes/                          # API маршруты (RESTful)
│   ├── 📄 userRoutes.js                 # /api/users/*
│   ├── 📄 skillRoutes.js                # /api/skills/*
│   ├── 📄 skillCategoryRoutes.js        # /api/categories/*
│   ├── 📄 topicRoutes.js                # /api/topics/*
│   ├── 📄 noteRoutes.js                 # /api/notes/*
│   ├── 📄 topicStatusRoutes.js          # /api/statuses/*
│   ├── 📄 feedbackRoutes.js             # /api/feedback/*
│   └── 📄 achievementRoutes.js          # /api/achievements/*
│
├── 🔧 utils/                           # Утилиты и вспомогательные классы
│   ├── 📄 achievementManager.js         # Менеджер системы достижений
│   ├── 📄 levelCalculator.js            # Калькулятор уровней пользователей
│   ├── 📄 databaseCleaner.js            # Очистка БД для тестов
│   └── 📄 portFinder.js                 # Автопоиск свободных портов
│
├── 🧪 tests/                           # Комплексное тестирование
│   ├── 📄 index.js                      # Главный файл тестов (автообнаружение сервера)
│   ├── 📄 testData.js                   # Генерация тестовых данных
│   │
│   ├── 🧪 Основные тесты модулей
│   ├── 📄 userApiTest.js                # Тесты пользователей
│   ├── 📄 skillTests.js                 # Тесты навыков
│   ├── 📄 categoryTests.js              # Тесты категорий
│   ├── 📄 topicTests.js                 # Тесты топиков
│   ├── 📄 noteTests.js                  # Тесты заметок
│   ├── 📄 statusTests.js                # Тесты статусов
│   ├── 📄 feedbackTests.js              # Тесты обратной связи
│   ├── 📄 feedbackApiExamples.js        # Примеры API обратной связи
│   └── 📄 avatarTests.js                # Тесты загрузки аватаров
│   │
│   ├── 🏆 Тесты системы достижений
│   ├── 📄 achievementTests.js           # Основные тесты достижений
│   ├── 📄 achievementTestRunner.js      # Запускатель тестов достижений
│   └── 📄 README_ACHIEVEMENT_TESTS.md   # Документация тестов достижений
│   │
│   ├── 🎖️ Тесты системы уровней
│   ├── 📄 levelTestSuite.js             # Комплексные тесты уровней
│   ├── 📄 levelCalculatorUnitTests.js   # Юнит-тесты калькулятора
│   ├── 📄 levelAPITests.js              # API тесты уровней
│   ├── 📄 userLevelTests.js             # Интеграционные тесты уровней
│   └── 📄 README_LEVEL_TESTS.md         # Документация тестов уровней
│
└── 📁 uploads/                         # Загруженные файлы
    └── 📁 avatars/                     # Аватары пользователей
        ├── 🖼️ avatar-3-*.webp         # Примеры загруженных аватаров
        └── ...
```

### 📊 Статистика проекта

- **📁 Всего файлов**: 67
- **📄 Основных файлов для продакшена**: 32 (48%)
- **🧪 Тестовых файлов**: 19 (28%)
- **🔧 Утилит разработки**: 16 (24%)

### 🎯 Ключевые компоненты

#### 🏗️ **Архитектурные компоненты**

- **8 контроллеров** - полная бизнес-логика
- **9 моделей данных** - структура БД
- **8 маршрутизаторов** - RESTful API
- **3 middleware** - безопасность и обработка
- **4 утилиты** - автоматизация и геймификация

#### 🎮 **Системы геймификации**

- **33 типа достижений** - полная система наград
- **5 уровней пользователей** - прогрессия навыков
- **Автоматическая интеграция** - seamless UX

#### 🧪 **Тестовое покрытие**

- **33 теста** основного функционала
- **12 тестов** системы достижений
- **Множественные тесты** системы уровней
- **100% автоматизация** - запуск без настройки

## 📖 Описание основных файлов

### 🔧 Конфигурация и инициализация

#### `index.js` - Главный файл приложения

Основной файл Express сервера с полной настройкой:

- Инициализация Express приложения
- Настройка CORS для кроссдоменных запросов
- Подключение middleware для обработки запросов и ошибок
- Настройка Swagger UI документации
- Подключение всех маршрутов API
- Обработка сигналов завершения процесса
- Health check эндпоинт для мониторинга

#### `config/db.js` - Конфигурация базы данных

Настройка подключения к PostgreSQL через Sequelize:

- Параметры подключения к БД
- Настройки пула соединений
- Логирование SQL запросов

#### `config/swagger.js` - Настройки Swagger

Конфигурация автоматической генерации API документации:

- Информация о API (название, версия, описание)
- Настройки серверов
- Схемы авторизации (JWT Bearer токены)
- Автоматический сбор документации из JSDoc комментариев

#### `syncDatabase.js` - Синхронизация базы данных

Утилита для синхронизации моделей Sequelize с БД:

- Проверка подключения к базе данных
- Создание/обновление таблиц
- Безопасная миграция структуры БД

### Модели данных

- `models/userModel.js` — User: id, name, email, password (bcrypt hash)
- `models/skillModel.js` — Skill: id, name, description, user_id, category_id
- `models/skillCategoryModel.js` — SkillCategory: id, name, description
- `models/topicModel.js` — Topic: id, name, description, skill_id, status_id, progress, estimated_hours
- `models/noteModel.js` — Note: id, title, content, topic_id, created_at
- `models/topicStatusModel.js` — TopicStatus: id, name, description, color

### 🗄️ Модели данных

#### `models/index.js` - Связи между моделями

Центральный файл для определения всех связей:

- User ↔ Skill (один ко многим)
- SkillCategory ↔ Skill (один ко многим)
- Skill ↔ Topic (один ко многим)
- TopicStatus ↔ Topic (один ко многим)
- Topic ↔ Note (один ко многим)
- Настройка foreign key constraints и каскадных операций

#### Модели сущностей:

- `userModel.js` - Пользователи (id, name, email, password_hash)
- `skillModel.js` - Навыки (id, title, description, owner_id, category_id)
- `skillCategoryModel.js` - Категории навыков (id, name, description)
- `topicModel.js` - Темы/задачи (id, title, description, skill_id, status_id)
- `noteModel.js` - Заметки (id, content, topic_id)
- `topicStatusModel.js` - Статусы тем (id, name, color)

### 🎮 Контроллеры

#### `userController.js` - Контроллер пользователей

Полный функционал управления пользователями:

- `register` - Регистрация с валидацией и хешированием пароля
- `login` - Авторизация с генерацией JWT токена
- `getProfile` - Получение профиля пользователя
- `updateProfile` - Обновление данных профиля
- `changePassword` - Смена пароля с проверкой старого
- `getUserFullInfo` - Полная информация с навыками и темами
- `deleteAccount` - Удаление аккаунта пользователя

#### Контроллеры для других сущностей:

- `skillController.js` - CRUD операции для навыков
- `skillCategoryController.js` - Управление категориями
- `topicController.js` - Управление темами с фильтрацией
- `noteController.js` - Управление заметками
- `topicStatusController.js` - Управление статусами

#### `userValidation.js` - Валидация данных

Класс для валидации пользовательских данных:

- Проверка формата email
- Валидация пароля (длина, сложность)
- Проверка имени пользователя
- Стандартизированный формат ошибок

### 🛡️ Middleware

#### `authMiddleware.js` - JWT аутентификация

Middleware для проверки авторизации:

- Извлечение JWT токена из заголовка Authorization
- Верификация токена и декодирование
- Проверка существования пользователя в БД
- Добавление данных пользователя в req.user

#### `errorHandler.js` - Обработка ошибок

Комплексная система обработки ошибок:

- Обработка ошибок Sequelize (валидация, уникальность, FK)
- Логирование ошибок с контекстом запроса
- Стандартизированные ответы API
- Middleware для валидации Content-Type
- Обработка превышения лимита размера запроса

- **authMiddleware.js** — JWT-аутентификация для защищённых маршрутов.
- **errorHandler.js** — Централизованная обработка ошибок, валидация, логирование, 404.
- **requestLogger** — Логирование всех запросов (метод, URL, статус, время, IP, user).
- **validateContentType** — Проверка Content-Type для POST/PUT/PATCH.
- **bodyLimitHandler** — Ограничение размера тела запроса.

## 📊 Swagger Documentation

- Автоматически собирается из JSDoc-комментариев в файлах маршрутов и контроллеров.
- Поддержка авторизации через Bearer JWT.
- Примеры схем и ответов для всех эндпоинтов.
- Доступно по адресу: `http://localhost:3000/api-docs`

## 🧪 Тестирование

### Полная автоматизация тестирования

Тестовая система полностью автоматизирована и не требует ручной настройки:

- 🔍 **Автообнаружение сервера** на портах 3000-3010
- 🗄️ **Автоочистка БД** перед каждым запуском
- 📦 **Автозагрузка тестовых данных**
- 🏆 **Интеграция с системой достижений**

### Команды тестирования

```bash
# Полное тестирование всего API
npm test

# Тестирование конкретных модулей
npm run test:achievements         # Система достижений
npm run test:achievements-quick   # Быстрый тест достижений
npm run test:levels-standalone    # Система уровней (автономно)
npm run test:levels-unit         # Юнит-тесты уровней
npm run test:levels-quick        # Быстрый тест уровней
npm run test:levels-only         # Тесты уровней через основной файл
```

### Покрытие тестирования

#### ✅ **Основные модули** (100% покрытие)

- 👤 **Пользователи**: регистрация, авторизация, профиль, уровни
- 📚 **Навыки**: CRUD операции, связи с категориями
- 📋 **Категории**: управление, статистика
- 📝 **Топики**: создание, обновление прогресса, статусы
- 📄 **Заметки**: создание, поиск, привязка к топикам
- 🎯 **Статусы**: управление статусами топиков
- 📬 **Обратная связь**: отправка и управление
- 🖼️ **Аватары**: загрузка и удаление изображений

#### ✅ **Системы геймификации** (100% покрытие)

- 🏆 **33 типа достижений**: автопроверка при действиях
- 📊 **Статистика достижений**: прогресс, очки, рейтинг
- 🏅 **Таблица лидеров**: сортировка по очкам
- 🎖️ **5 уровней пользователей**: автообновление при завершении топиков

#### ✅ **Автоматизация и утилиты**

- 🔧 **PortFinder**: поиск свободных портов
- 🗄️ **DatabaseCleaner**: очистка БД для тестов
- ⚙️ **AchievementManager**: проверка и выдача достижений
- 📈 **LevelCalculator**: расчёт уровней пользователей

### Статистика тестирования

По результатам последнего запуска:

- **📊 Всего тестов**: 33
- **✅ Успешно**: 33 (100%)
- **❌ Неудачно**: 0 (0%)
- **🎯 Система достижений**: 12/12 тестов (100%)

## 🧪 Полное тестирование API через Swagger UI

### 🎖️ Система уровней пользователя

Реализована автоматическая система определения уровня пользователя на основе завершенных топиков:

**Уровни:**

- **Новичок**: 0-4 завершенных топика
- **Средний**: 5-19 завершенных топиков
- **Продвинутый**: 20-49 завершенных топиков
- **Профессионал**: 50-99 завершенных топиков
- **Эксперт**: 100+ завершенных топиков

**Автоматическое обновление уровня при:**

- ✅ Завершении топика (progress = 100%)
- ✅ Изменении прогресса с 100% на меньшее значение
- ✅ Удалении завершенного топика

**Новые API endpoints:**

- `GET /api/users/progress-stats` - статистика прогресса пользователя
- `POST /api/users/recalculate-level` - пересчет уровня пользователя

**Тестирование системы уровней:**

```bash
# Все тесты приложения (включая систему уровней)
npm test

# Только тесты системы уровней через основной файл
npm run test:levels-only

# Автономные тесты системы уровней
npm run test:levels-standalone

# Только юнит-тесты уровней (не требуют сервера)
npm run test:levels-unit

# Быстрый тест основных функций уровней
npm run test:levels-quick
```

**Пересчет уровней для существующих пользователей:**

```bash
node recalculateLevels.js
```

Подробнее о тестах системы уровней: [tests/README_LEVEL_TESTS.md](tests/README_LEVEL_TESTS.md)

### 📋 Справочник команд тестирования

| Команда                           | Описание                          | Требует сервер |
| --------------------------------- | --------------------------------- | -------------- |
| `npm test`                        | Все тесты приложения              | Да             |
| `npm run test:levels-only`        | Тесты уровней через основной файл | Частично\*     |
| `npm run test:levels-standalone`  | Автономные тесты уровней          | Частично\*     |
| `npm run test:levels-unit`        | Только юнит-тесты уровней         | Нет            |
| `npm run test:levels-quick`       | Быстрый тест функций              | Нет            |
| `npm run test:achievements`       | Все тесты системы достижений      | Да             |
| `npm run test:achievements-quick` | Быстрый тест достижений           | Да             |

\*Юнит-тесты выполняются всегда, интеграционные тесты только при запущенном сервере

### 🏆 Система достижений

#### Команды управления достижениями

- `npm run init-achievements` - Инициализация достижений в базе данных

#### Типы достижений:

- **topics_completed** - За количество завершённых топиков
- **skills_created** - За количество созданных навыков
- **notes_written** - За количество написанных заметок
- **level_reached** - За достижение определённого уровня
- **categories_mastered** - За освоение категорий навыков
- **first_action** - За первые действия (первый навык, топик, заметка)
- **special** - Специальные достижения

#### API достижений:

- `GET /api/achievements` - Все доступные достижения
- `GET /api/achievements/my` - Достижения пользователя
- `GET /api/achievements/stats` - Статистика достижений пользователя
- `GET /api/achievements/progress` - Прогресс по всем достижениям
- `GET /api/achievements/recent` - Недавние достижения
- `GET /api/achievements/leaderboard` - Таблица лидеров
- `POST /api/achievements/recheck` - Пересчёт достижений пользователя

## 📖 Описание основных файлов

### Модели данных

- `models/userModel.js` — User: id, name, email, password (bcrypt hash)
- `models/skillModel.js` — Skill: id, name, description, user_id, category_id
- `models/skillCategoryModel.js` — SkillCategory: id, name, description
- `models/topicModel.js` — Topic: id, name, description, skill_id, status_id, progress, estimated_hours
- `models/noteModel.js` — Note: id, title, content, topic_id, created_at
- `models/topicStatusModel.js` — TopicStatus: id, name, description, color

### 🔧 Конфигурация и инициализация

#### `index.js` - Главный файл приложения

Основной файл Express сервера с полной настройкой:

- Инициализация Express приложения
- Настройка CORS для кроссдоменных запросов
- Подключение middleware для обработки запросов и ошибок
- Настройка Swagger UI документации
- Подключение всех маршрутов API
- Обработка сигналов завершения процесса
- Health check эндпоинт для мониторинга

#### `config/db.js` - Конфигурация базы данных

Настройка подключения к PostgreSQL через Sequelize:

- Параметры подключения к БД
- Настройки пула соединений
- Логирование SQL запросов

#### `config/swagger.js` - Настройки Swagger

Конфигурация автоматической генерации API документации:

- Информация о API (название, версия, описание)
- Настройки серверов
- Схемы авторизации (JWT Bearer токены)
- Автоматический сбор документации из JSDoc комментариев

#### `syncDatabase.js` - Синхронизация базы данных

Утилита для синхронизации моделей Sequelize с БД:

- Проверка подключения к базе данных
- Создание/обновление таблиц
- Безопасная миграция структуры БД

## 🏗️ Архитектура

### MVC Pattern + Microservices Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    🌐 Client Applications                    │
│              (Frontend, Mobile, Postman, etc.)              │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                   🛣️ API Routes Layer                       │
│    RESTful Endpoints (/api/users, /api/skills, etc.)       │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                 🛡️ Middleware Layer                        │
│   ┌─────────────┬─────────────┬─────────────────────────┐  │
│   │ Auth JWT    │ Error       │ Image Upload            │  │
│   │ Validation  │ Handling    │ Request Logging         │  │
│   └─────────────┴─────────────┴─────────────────────────┘  │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                  🎮 Controllers Layer                       │
│   ┌─────────────┬─────────────┬─────────────────────────┐  │
│   │ User        │ Skills      │ Topics & Notes          │  │
│   │ Management  │ & Categories│ Management              │  │
│   │             │             │                         │  │
│   │ Achievement │ Feedback    │ File Upload             │  │
│   │ System      │ System      │ Management              │  │
│   └─────────────┴─────────────┴─────────────────────────┘  │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                🔧 Business Logic Layer                      │
│   ┌─────────────┬─────────────┬─────────────────────────┐  │
│   │ Achievement │ Level       │ Port Management         │  │
│   │ Manager     │ Calculator  │ Database Cleaner        │  │
│   └─────────────┴─────────────┴─────────────────────────┘  │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                   🗄️ Data Layer                            │
│   ┌─────────────┬─────────────┬─────────────────────────┐  │
│   │ Sequelize   │ PostgreSQL  │ File System             │  │
│   │ ORM Models  │ Database    │ (Avatars)               │  │
│   └─────────────┴─────────────┴─────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 🎯 Ключевые особенности

- **🏆 Система достижений**: 33 типа наград с автоматической выдачей
- **🎖️ Система уровней**: 5 уровней с автообновлением прогресса
- **🔧 Автоматизация**: умное управление портами и автотестирование
- **🛡️ Безопасность**: JWT авторизация + централизованная обработка ошибок
- **📊 Полное API**: RESTful дизайн + Swagger документация
- **🧪 100% покрытие тестами**: автоматизированное тестирование всех компонентов

---

## 🚀 Готово к использованию!

1. **Установка**: `npm install`
2. **Настройка БД**: Создайте PostgreSQL базу `tracker`
3. **Инициализация**: `npm run sync-db && npm run init-achievements`
4. **Запуск**: `npm run dev`
5. **Тестирование**: `npm test`
6. **Документация**: http://localhost:3000/api-docs

**🎯 Полнофункциональная платформа для отслеживания навыков с геймификацией готова к работе!**
