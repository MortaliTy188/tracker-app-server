# –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ - —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Tracker App. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 18 –∏—é–Ω—è 2025  
**–¢–µ—Å—Ç—ã:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. –ú–æ–¥–µ–ª—å ActivityLog (`models/activityLogModel.js`)

Sequelize –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ PostgreSQL:

```javascript
{
  id: INTEGER (PK, AUTO_INCREMENT),
  user_id: INTEGER (FK to users.id),
  action: ENUM (—Ç–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π),
  details: JSONB (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è),
  ip_address: STRING(45),
  user_agent: TEXT,
  created_at: DATE
}
```

**–°–≤—è–∑–∏:**

- `belongsTo(User, { foreignKey: 'user_id', as: 'user' })` - —Å–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### 2. ActivityLogger (`utils/activityLogger.js`)

–£—Ç–∏–ª–∏—Ç–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞—Ö–≤–∞—Ç–æ–º IP-–∞–¥—Ä–µ—Å–∞ –∏ User-Agent:

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

- `log(userId, action, details, req)` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `getUserActivity(userId, options)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- `getActivityStats(userId, options)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

- `logLogin(userId, req)` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞
- `logLogout(userId, req)` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–∞

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è:**

- `logProfileUpdate(userId, changedFields, oldValues, newValues, req)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `logAvatarChange(userId, oldAvatar, newAvatar, req)` - —Å–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞
- `logEmailChange(userId, oldEmail, newEmail, req)` - —Å–º–µ–Ω–∞ email
- `logUsernameChange(userId, oldUsername, newUsername, req)` - —Å–º–µ–Ω–∞ –∏–º–µ–Ω–∏
- `logPasswordChange(userId, req)` - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –Ω–∞–≤—ã–∫–æ–≤:**

- `logSkillCreated/Updated/Deleted(userId, skillData, req)` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –Ω–∞–≤—ã–∫–∞–º–∏

**–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ç–æ–ø–∏–∫–æ–≤:**

- `logTopicCreated/Completed/Updated(userId, topicData, req)` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–º–µ—Ç–æ–∫:**

- `logNoteCreated/Updated/Deleted(userId, noteData, req)` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏:**

- `logAchievementEarned(userId, achievementData, req)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- `logFeedbackSubmitted(userId, feedbackData, req)` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

### 3. Activity Controller (`controllers/activityController.js`)

REST API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

**–î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:**

- `getMyActivity` - –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `getActivityStats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (page, limit)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –¥–µ–π—Å—Ç–≤–∏—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
- –í–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –æ—Ç–≤–µ—Ç

### 4. Activity Routes (`routes/activityRoutes.js`)

API endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é:

- `GET /api/activity/my` - –º–æ—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: page, limit, action, startDate, endDate)
- `GET /api/activity/stats` - –º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ó–∞—â–∏—Ç–∞:** –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω.

## –¢–∏–ø—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π (enum –∑–Ω–∞—á–µ–Ω–∏—è):

```javascript
const ACTIVITY_TYPES = [
  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  "LOGIN", // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
  "LOGOUT", // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

  // –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "PROFILE_UPDATE", // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  "AVATAR_CHANGE", // –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞
  "EMAIL_CHANGE", // –°–º–µ–Ω–∞ email
  "USERNAME_CHANGE", // –°–º–µ–Ω–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "PASSWORD_CHANGE", // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

  // –ù–∞–≤—ã–∫–∏
  "SKILL_CREATED", // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞
  "SKILL_UPDATED", // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–∞
  "SKILL_DELETED", // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–∞

  // –¢–æ–ø–∏–∫–∏
  "TOPIC_CREATED", // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞
  "TOPIC_COMPLETED", // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞
  "TOPIC_UPDATED", // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞

  // –ó–∞–º–µ—Ç–∫–∏
  "NOTE_CREATED", // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
  "NOTE_UPDATED", // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
  "NOTE_DELETED", // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏

  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
  "ACHIEVEMENT_EARNED", // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  "FEEDBACK_SUBMITTED", // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
];
```

**–í–∞–∂–Ω–æ:** –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤

### –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```javascript
{
  id: 1,
  user_id: 123,
  action: "NOTE_CREATED",
  details: {
    noteId: 456,
    noteTitle: "–ú–æ—è –∑–∞–º–µ—Ç–∫–∞",
    topicId: 789
  },
  ip_address: "192.168.1.1",
  user_agent: "Mozilla/5.0...",
  created_at: "2025-06-18T10:30:00Z"
}
```

### –ü—Ä–∏–º–µ—Ä—ã details –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

#### LOGIN/LOGOUT

```javascript
{
  loginTime: "2025-06-18T10:30:00Z";
}
// –∏–ª–∏
{
  logoutTime: "2025-06-18T10:30:00Z";
}
```

#### PROFILE_UPDATE

```javascript
{
  changedFields: ["name", "email"],
  oldValues: { name: "Old Name", email: "old@email.com" },
  newValues: { name: "New Name", email: "new@email.com" }
}
```

#### SKILL_CREATED

```javascript
{
  skillId: 456,
  skillTitle: "JavaScript Basics",
  categoryId: 1
}
```

#### NOTE_CREATED

```javascript
{
  noteId: 456,
  noteTitle: "–ú–æ—è –∑–∞–º–µ—Ç–∫–∞",
  topicId: 789
}
```

#### TOPIC_COMPLETED

```javascript
{
  topicId: 123,
  topicTitle: "–í–≤–µ–¥–µ–Ω–∏–µ –≤ JavaScript",
  skillId: 456,
  completedAt: "2025-06-18T10:30:00Z"
}
```

#### ACHIEVEMENT_EARNED

```javascript
{
  achievementId: 123,
  achievementTitle: "–ü–µ—Ä–≤–∞—è –∑–∞–º–µ—Ç–∫–∞",
  achievementType: "progress",
  earnedAt: "2025-06-18T10:30:00Z"
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ userController:

```javascript
const ActivityLogger = require('../utils/activityLogger');

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É
async login(req, res) {
  try {
    // ... –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ...

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞
    await ActivityLogger.logLogin(user.id, req);

    res.json({ success: true, data: { user, token } });
  } catch (error) {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ...
  }
}

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–≤—ã–∫–∞
async createSkill(req, res) {
  try {
    const skill = await Skill.create(skillData);

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–≤—ã–∫–∞
    await ActivityLogger.logSkillCreated(req.user.id, skill, req);

    res.json({ success: true, data: { skill } });
  } catch (error) {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ...
  }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ middleware:

```javascript
// –í routes —Ñ–∞–π–ª–µ
router.post("/skills", auth, async (req, res) => {
  try {
    const skill = await skillController.createSkill(req, res);
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
  } catch (error) {
    res.status(500).json({ success: false, message: error.message });
  }
});
```

## API –ü—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª—É—á–∏—Ç—å –º–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

```bash
GET /api/activity/my?page=1&limit=20&action=LOGIN&startDate=2025-06-01&endDate=2025-06-18
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**

```javascript
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": 1,
        "user_id": 123,
        "action": "LOGIN",
        "details": { "loginTime": "2025-06-18T10:30:00Z" },
        "ip_address": "192.168.1.1",
        "user_agent": "Mozilla/5.0...",
        "created_at": "2025-06-18T10:30:00Z",
        "user": {
          "id": 123,
          "username": "john_doe",
          "email": "john@example.com"
        }
      }
    ],
    "totalCount": 1,
    "totalPages": 1,
    "currentPage": 1,
    "hasNext": false,
    "hasPrev": false
  }
}
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

```bash
GET /api/activity/stats
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**

```javascript
{
  "success": true,
  "data": [
    { "action": "LOGIN", "count": 15 },
    { "action": "NOTE_CREATED", "count": 8 },
    { "action": "TOPIC_COMPLETED", "count": 5 }
  ]
}
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

```bash
GET /api/activity/stats?startDate=2025-06-01&endDate=2025-06-18
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**

```javascript
{
  "success": true,
  "data": [
    { "action": "LOGIN", "count": "15" },
    { "action": "NOTE_CREATED", "count": "8" },
    { "action": "TOPIC_COMPLETED", "count": "5" },
    { "action": "SKILL_CREATED", "count": "3" }
  ]
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã (–≤–∫–ª—é—á–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
node tests/index.js

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
node tests/activityTests.js
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:

1. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - —Ç–µ—Å—Ç API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤
2. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - —Ç–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏** - —Ç–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–∞–≤—ã–∫–∞
4. ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É** - —Ç–µ—Å—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –ª–∏–º–∏—Ç–æ–≤
5. ‚úÖ **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - —Ç–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

```
üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...

‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:
–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 5
–ü—Ä–æ—à–ª–æ: 5
–ü—Ä–æ–≤–∞–ª–µ–Ω–æ: 0
–°—Ç–∞—Ç—É—Å: ‚úÖ
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ (–≤ –¥–Ω—è—Ö)
ACTIVITY_LOG_RETENTION_DAYS=90

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –∑–∞–ø—Ä–æ—Å
ACTIVITY_LOG_MAX_LIMIT=100
```

### –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:

```sql
CREATE INDEX activity_logs_user_id_created_at_idx ON activity_logs (user_id, created_at);
CREATE INDEX activity_logs_action_created_at_idx ON activity_logs (action, created_at);
CREATE INDEX activity_logs_created_at_idx ON activity_logs (created_at);
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

- –ü–∞—Ä–æ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –¥–µ—Ç–∞–ª—è—Ö
- IP –∞–¥—Ä–µ—Å–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
- User-Agent —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –î–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –æ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø–∞—Ä–æ–ª–µ–π

### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ª–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ JWT
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞—Ö–≤–∞—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ (IP, User-Agent)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Sequelize ORM
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –í–∫–ª—é—á–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ JOIN

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ API

–í—Å–µ API –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```javascript
{
  "success": boolean,
  "data": {
    "logs": [...],           // –ú–∞—Å—Å–∏–≤ –ª–æ–≥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    "totalCount": number,    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
    "totalPages": number,    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
    "currentPage": number,   // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    "hasNext": boolean,      // –ï—Å—Ç—å –ª–∏ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    "hasPrev": boolean       // –ï—Å—Ç—å –ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  }
}
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

1. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –≤ enum –º–æ–¥–µ–ª–∏ ActivityLog
2. –°–æ–∑–¥–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ –≤ ActivityLogger
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ –≤ –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
4. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–ü—Ä–∏–º–µ—Ä:

```javascript
// –í ActivityLogger
static async logCustomAction(userId, customData, req) {
  return this.log(
    userId,
    "CUSTOM_ACTION",
    {
      customField: customData.field,
      timestamp: new Date(),
    },
    req
  );
}

// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
await ActivityLogger.logCustomAction(req.user.id, data, req);
```

## Troubleshooting

### –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

1. **–õ–æ–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è**

   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–æ–≤ ActivityLogger

2. **–û—à–∏–±–∫–∏ enum –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏**

   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ enum –≤ –º–æ–¥–µ–ª–∏ –∏ ActivityLogger

3. **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã page –∏ limit)
   - –ü—Ä–∏–º–µ–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –û—Ç–ª–∞–¥–∫–∞

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
SELECT * FROM activity_logs ORDER BY created_at DESC LIMIT 10;

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∏–ø–∞–º –¥–µ–π—Å—Ç–≤–∏–π
SELECT action, COUNT(*) as count
FROM activity_logs
GROUP BY action
ORDER BY count DESC;

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT * FROM activity_logs
WHERE user_id = ?
ORDER BY created_at DESC;
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
# –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
node tests/index.js

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
node tests/activityTests.js
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ (100% success rate).

---

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞:** 18 –∏—é–Ω—è 2025  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** 1.0 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è)  
**–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤:** ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
