# API для получения списка пользователей

## Новый endpoint: `GET /api/users/all`

### Описание

Endpoint для получения списка всех пользователей с краткой статистикой. Поддерживает пагинацию и поиск.

### Параметры запроса

| Параметр | Тип     | По умолчанию | Описание                             |
| -------- | ------- | ------------ | ------------------------------------ |
| `page`   | integer | 1            | Номер страницы                       |
| `limit`  | integer | 20           | Количество пользователей на странице |
| `search` | string  | -            | Поиск по имени пользователя          |

### Пример запроса

```http
GET /api/users/all?page=1&limit=10&search=test
```

### Пример ответа

```json
{
  "success": true,
  "message": "Список пользователей получен",
  "data": {
    "users": [
      {
        "id": 14,
        "name": "Topic Test User",
        "avatar": null,
        "level": "новичок",
        "registrationDate": "2025-06-19T08:15:28.560Z",
        "isPrivate": false,
        "stats": {
          "achievements": {
            "completed": 5,
            "total": 35,
            "points": 150
          },
          "progress": {
            "totalSkills": 1,
            "totalTopics": 1,
            "completedTopics": 0,
            "completionPercentage": 0
          }
        }
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 3,
      "totalUsers": 11,
      "usersPerPage": 10,
      "hasNextPage": true,
      "hasPrevPage": false
    },
    "summary": {
      "totalUsers": 11,
      "publicUsers": 5,
      "privateUsers": 0
    }
  }
}
```

### Поведение для приватных профилей

Для пользователей с приватными профилями (`isPrivate: true`) статистика заменяется на:

```json
{
  "id": 15,
  "name": "Private User",
  "avatar": "/uploads/avatar.jpg",
  "level": "продвинутый",
  "registrationDate": "2025-06-18T10:30:00Z",
  "isPrivate": true,
  "stats": {
    "message": "Статистика скрыта пользователем"
  }
}
```

## API для получения списка пользователей

### Обзор

Этот API предоставляет список всех зарегистрированных пользователей с их базовой информацией и краткой статистикой. Поддерживает пагинацию, поиск по имени и учитывает настройки приватности профиля.

### Статус дружбы

Если запрос выполняется авторизованным пользователем, для каждого пользователя в списке будет добавлена информация о статусе дружбы:

- `self` - собственный профиль пользователя
- `none` - нет связи дружбы
- `pending` - есть активный запрос (общий статус)
- `sent_request` - текущий пользователь отправил запрос
- `received_request` - текущий пользователь получил запрос
- `accepted` - пользователи друзья
- `declined` - запрос был отклонен
- `blocked` - один из пользователей заблокирован

### Авторизация и видимость

- **Неавторизованные пользователи**: получают полный список всех пользователей
- **Авторизованные пользователи**: получают список всех пользователей **кроме самого себя** + информацию о статусе дружбы с каждым пользователем
- При поиске авторизованный пользователь также не найдет самого себя в результатах

### Статус дружбы (только для авторизованных пользователей)

Каждый пользователь в ответе для авторизованного пользователя содержит поле `friendship`:

```json
{
  "friendship": {
    "status": "accepted", // none | sent_request | received_request | accepted | blocked
    "friendshipId": 123 // ID записи дружбы (null для статуса "none")
  }
}
```

Возможные статусы дружбы:

- `none` - нет дружеских отношений
- `sent_request` - текущий пользователь отправил запрос
- `received_request` - текущий пользователь получил запрос
- `accepted` - дружба подтверждена
- `blocked` - пользователь заблокирован

### Использование

Этот endpoint идеально подходит для:

1. **Страницы "Пользователи"** - показать всех зарегистрированных пользователей
2. **Лидерборды** - сортировка по очкам или достижениям
3. **Поиска пользователей** - найти конкретного пользователя по имени
4. **Администрирования** - обзор всех пользователей системы

### Особенности

- ✅ **Пагинация** - эффективная обработка больших списков пользователей
- ✅ **Поиск** - поиск по имени (регистронезависимый)
- ✅ **Приватность** - уважение к настройкам приватности пользователей
- ✅ **Статистика** - краткая статистика достижений и прогресса
- ✅ **Производительность** - оптимизированные запросы к базе данных
- ✅ **Обработка ошибок** - graceful fallback при проблемах со статистикой

### Коды ответов

- `200` - Успешное получение списка пользователей
- `500` - Внутренняя ошибка сервера
